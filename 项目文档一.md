《ACGN Personality Database》项目文档（提案版）

下面是一份可直接拿去开发的项目文档：包含整体目标、关键功能、系统架构、数据库设计、爬虫/LLM 接入方案、前端组件与 UI 指南、部署与运维要点、隐私/合规与迭代路线。文档以中文呈现，尽量把实现细节、接口样例和工程决策列清楚，便于开发/评审/估时。

说明：本项目参考并类比了 Personality-Database 的主要产品形态（人物条目 + 用户投票/标签/评论）。若需我把文档转换为项目 README、技术设计文档（TDD）或具体任务卡（Jira/Trello），我可以直接生成。
personality-database.com

1 项目概述与目标

目标：打造面向 ACGN（动画 Anime、漫画 Comic、游戏 Game、小说 Novel）作品与角色的人格学数据库，用户可提交作品/人物、对人物发起/参与“人格学投票”（MBTI、九型含侧翼、副型、易学人格学等）、发表评论与投票，系统自动抓取并保存外部资料（萌娘百科、维基、百度百科）的简介、图片与角色链接，最终在作品页与角色页展示投票统计与来源资料。
萌娘百科
+1

主要受众：ACGN 爱好者、人格学兴趣者、社区用户。

风格：极简 UI，配色采用 EVA 设计风格（EVA 配色 / 语义色生成器作为参考），主色系为 EVA 调和的绿色系（可用 colors.eva.design 生成具体变量）。
colors.eva.design

技术栈（建议）：

前端：React + Tailwind CSS + lucide 图标库 + Vite/Next.js（可选，若需 SSR/SEO 用 Next.js/Next13）。
Lucide

后端 / 数据层：Supabase（Postgres + Auth + Storage + Realtime）。
Supabase

爬虫服务：Firecrawl（把外部页面抓为干净 Markdown / HTML 片段，便于解析）。
docs.firecrawl.dev
+1

大模型（可选，用于实体匹配、人物抽取、摘要、模糊搜索、自动标签）：DeepSeek 或 通义千问（Qwen）/其他可选模型。DeepSeek 有开放 API；通义千问有阿里云的 API 文档与 SDK。选择时考虑成本、中文能力与隐私策略。
deepseek.com
+1

2 功能清单（高优先级 -> 低优先级）
核心功能（V1）

用户系统（注册/登陆/邮箱验证/第三方 OAuth）— 使用 Supabase Auth。
Supabase

提交 ACGN 作品（作品名 + 可选年份/作者/语言）并触发自动抓取（Firecrawl）从萌娘百科/维基/百度百科采集资料与角色链接、图片。
docs.firecrawl.dev
+2
萌娘百科
+2

作品页面：显示作品简介（抓取内容）、角色列表（每个角色的来源链接与图片）、发起/参与“人格学投票”。

投票系统：支持多种人格学投票选项（MBTI、九型含侧翼、副型、易学人格学）。用户对单个角色可投票一次（或带更复杂的“撤销/更改”规则）。统计实时展示（百分比、票数、时间序列）。

评论系统：角色页/作品页可评论，支持回复、点赞、举报。

管理后台：人工审核爬取结果、合并重复条目、处理举报、编辑角色元数据。

扩展/未来功能（V2+）

角色比对页（类似 Personality-Database 的对比功能）。
personality-database.com

用户个人收藏、关注作者、关注作品。

社区事件与排行榜（最受欢迎角色、最近热门投票）。

多语言支持（中/英）。

导出 JSON / API（公开只读的聚合数据）。

用 LLM 提供“投票推荐”或“性格摘要”功能（须加说明与人工复核）。

3 系统架构（总体）

简要架构图（文字版）：

[用户浏览器 / SPA React] <---> [Edge CDN] <---> [Frontend Hosting (Vercel/Cloudflare Pages)] 
                     |
                     v
                REST/GraphQL APIs
                     |
[Supabase Auth] [Supabase Postgres] [Supabase Storage (images)] 
                     |
         [后台 Worker / Serverless Functions]
             |                |
    [Firecrawl API]      [LLM API: DeepSeek / Qwen]
             \                /
              -> 数据处理 / 实体匹配 / 入库逻辑


要点：

所有爬取通过后端 worker（Serverless）发起 Firecrawl 请求，Firecrawl 返回干净 Markdown/HTML，然后后端用解析器抽取角色名、图片链接、简介并把“来源 URL 与抓取时间”作为元数据存入 Supabase。
docs.firecrawl.dev
+1

对于不确定的实体匹配（例如“同名不同作品”或多语言别名），调用 LLM（DeepSeek 或 Qwen）做模糊匹配/消歧与优先级判断，输出可信度与候选来源供人工审核。
deepseek.com
+1

图片与大文件存储在 Supabase Storage，并使用 RLS（Row Level Security）和短期 CDN 链接展示。
Supabase

4 数据模型（Postgres / Supabase）—— 核心表

下面是建议的主要表（字段为示例）：

users

id (uuid PK)

email

username

display_name

avatar_url

role (user/mod/admin)

created_at

works（作品）

id (uuid)

title (text)

title_orig (原名，含日/英)

aliases (text[])

type (enum: anime, manga, game, novel)

summary_md (抓取得到的简介 Markdown)

primary_source (url)

source_snapshot_id -> source_snapshots

created_by (user_id)

created_at

characters（角色）

id (uuid)

work_id (FK)

name (text)

name_alt (text[])

image_url (storage path)

summary_md

sources (jsonb) — 列出每个来源的 url / title / snapshot

created_at

source_snapshots

id

url

fetched_at

fetched_by (firecrawl_job_id)

raw_md (text)

raw_html (optional)

license_info (text) — 是否注明可商用 / 转载要求

polls（人格学投票活动）

id

character_id

poll_type (enum: mbti, enneagram, enneagram_wing, enneagram_subtype, yi-personality)

created_by

created_at

closed_at (nullable)

visibility (public/private)

votes

id

poll_id

user_id (nullable for anonymous? 推荐 require login)

choice (text) — e.g., "INTJ" / "4w5"

created_at

weight (int) — 默认为1，后续可做信誉加权

comments

id

target_type (work/character/poll)

target_id

user_id

content_md

parent_comment_id (nullable)

created_at

is_deleted/flagged

audit_logs / moderation（记录合并与人工操作）

说明：投票统计直接用聚合 SQL（GROUP BY choice）/视图，配合 Supabase Realtime 可实现前端及时更新。
Supabase

5 爬虫与数据采集（Firecrawl 流程）
为什么用 Firecrawl

Firecrawl 提供“传入 URL -> 返回干净 Markdown（包括子页面）”的 API，省去自建分布式爬虫与 HTML 清洗的工作，适合把百科类页面转换为可解析的结构化文本。
docs.firecrawl.dev
+1

抓取工作流（示例）

用户提交作品名（或手动选择已存在作品）并点击“抓取资料”。

后端创建 Firecrawl Job：

POST https://api.firecrawl.dev/v1/crawl（或文档要求的 endpoint），在 Header 增加 Authorization: Bearer fc-<APIKEY>（示例）。Firecrawl 会返回 job id 与可下载的 Markdown/HTML。参考 Firecrawl 文档的认证/响应示例。
docs.firecrawl.dev

Firecrawl 完成后，后端拿到 Markdown -> 解析（正则/DOM/Markdown AST）：

提取作品简介（首段）、章节/角色列表、图片链接（优先使用页面内带的高质量图像）、条目内人物小节链接（内部链接指向角色详情页）。

对抽取出的候选角色名调用实体对齐模块（LLM +规则）：

LLM 根据抓取到的文本及候选角色名判断是否为“主要角色/配角/同名角色”。若 LLM 置信度低，自动进入人工审核队列。
deepseek.com
+1

存入 source_snapshots，并把角色/作品入库，图片下载到 Supabase Storage，生成 CDN 链接供前端使用。

抓取边界与合规建议

尊重来源站点的 robots.txt 与版权声明（萌娘百科含有“内容不可商用，转载请注明来源”之类声明，需要在页面显示明确来源与转载声明）。在前端展示处应保留“来源链接 + 抓取时间 + 原始页面声明”。若要大量抓取并公开展示整段内容，应先确认版权与许可（尤其百度百科、萌娘百科的内容许可不同）。
萌娘百科

6 LLM 集成（用于实体匹配、摘要、模糊查询、自动标签）

候选模型：DeepSeek（提供 reasoning-first API，适合 agent 场景）或 阿里通义千问（Qwen 系列）。选择考虑点：中文表现、接口价格、带宽/延迟、隐私条款。
deepseek.com
+1

用途举例：

抓取后：将页面总结为 1~3 段简短简介（供作品页展示）。

角色消歧：当同名角色在不同作品中出现，LLM 返回最匹配的作品/角色候选及置信度。

自动将用户长文本评论生成“快速标签”（可选）。

风险与对策：

LLM 可能生成不准确结论。所有 LLM 自动结果须标注“由模型生成，供参考”，并在重要变更前等待人工审核（如自动创建新角色）。

记录 LLM 调用请求/响应以便审计（并遵守隐私/数据 retention policy）。

7 前端实现建议（React + Tailwind + lucide）
UI 指南

主色：EVA 风格的绿色系，使用 EVA Colors generator 生成语义色（primary / success / bg / surface / text）。确保暗色模式也有对应配色。
colors.eva.design

版式：简洁卡片式布局，角色卡包含：头像（圆角），角色名，所属作品，投票汇总（小条形）、快速投票按钮。

icon：使用 lucide-react ，按需导入以减小包体积。
Lucide

建议组件（高层）

WorkPage：作品头部（标题/别名/来源），简介（MD 渲染），角色网格，发起投票按钮。

CharacterCard：图片、名字、当前主流人格（若已统计）、快速投票入口。

PollModal：投票交互（选择类型与选项），显示当前投票分布。

CommentThread：评论与回复，支持 Markdown 编辑器（简化版）。

AdminDashboard：抓取任务队列、人工合并条目、审核投票异常。

SEO 考量

作品与角色页面建议做 SSR/SSG（若用 Next.js 可用静态生成 + ISR）以利于搜索引擎抓取（作品名是大量长尾流量来源）。如果使用纯 SPA（Vercel/Cloudflare Pages）需配置 server-side rendered meta 或 prerender。

8 投票系统细节（需严格设计以防刷票）

验证与限制：

强制登录才可投票（较稳妥）。

每个用户对同一 poll 只能有一条最新 vote，支持撤销与更改（记录操作历史）。

速率限制：同一 IP / 用户在短时间内投票过多触发风控；记录投票时间序列检测异常行为。

投票统计：

采用 Postgres 聚合视图：SELECT choice, COUNT(*) FROM votes WHERE poll_id = ? GROUP BY choice，并配合索引与缓存（Redis/edge cache）用于高访问量场景。

前端展示百分比、票数、并显示最近投票活动（时间/用户匿名化）。

信誉与加权（可选 V2）：

为了提升数据质量，可考虑“信誉分”体系：活跃且贡献高质量内容的用户投票权重更高（复杂度高，列为可选）。

9 Moderation 与社区规范

举报机制：评论/投票/用户资料均可举报，管理后台可查看举报队列。

内容显示政策：必须明确禁止未成年人不当内容、仇恨/歧视、明显侵犯版权的转载（除非来源许可）。

自动检测：用简单关键词匹配+人工审核结合，对大量垃圾评论/刷票做速率限制与封禁。

10 部署、监控与成本估算（粗略）

前端：Vercel / Netlify / Cloudflare Pages（静态 + Serverless）。

后端：Supabase 主 DB + Storage（按使用计费）。

Firecrawl：第三方 API，根据调用量计费（需评估抓取频率/量）。
docs.firecrawl.dev

LLM：DeepSeek / 通义千问 均按 API 调用计费（估算成本取决于用量与模型选择）。
deepseek.com
+1

监控：Sentry、Prometheus（自建），以及 Supabase 自带监控。

初期小规模成本（示例，极粗略）：

Supabase 免费额度（小项目可用） -> 实际生产需根据请求/存储升级。

Firecrawl 与 LLM 每月可能各需几十到数百美金（视调用量）。（需与厂商接洽获取精确报价）

11 法律/版权与合规建议（必须重视）

显示第三方百科内容时，必须遵循来源网站的 license/转载规则，并在页面明显位置声明“来源 & 抓取时间 & 原文链接”。萌娘百科等可能有“禁止商用或需署名”条款，务必遵守。
萌娘百科

若要对 Wikipedia 内容使用，请遵守 CC BY-SA 许可条款（保留来源与署名、相同方式共享等）。

收集用户数据时遵守隐私政策（提供隐私条款、cookie 通知、数据删除请求渠道）。

12 开发优先级里程碑（建议）

第 0 周（准备）：确定模型与第三方服务（Firecrawl、LLM）、注册 Supabase、申请 Firecrawl API Key、做 UI 颜色 Token（EVA）与基本设计。
docs.firecrawl.dev
+1

第 1-2 周（MVP）：实现用户注册/登陆、作品提交界面、后端 Worker 调用 Firecrawl 并把抓取结果入库、作品页与角色页基本展示（图片+简介+来源）。
docs.firecrawl.dev

第 3-4 周：投票功能（创建 poll + 投票 + 统计展示）与评论系统、基础管理后台（查看任务/审核）。

第 5-6 周：LLM 集成（实体匹配/摘要）、防刷策略、更多 UI 优化与 SEO。

第 7 周以后：扩展功能、性能优化、上线前安全测试。

13 示例 API / Worker 伪代码（抓取与入库）
// Serverless worker (Node) - 伪代码
import fetch from 'node-fetch';
import { supabase } from './supabaseClient';

async function fetchAndIngest(url, createdBy) {
  // 发 Firecrawl
  const resp = await fetch('https://api.firecrawl.dev/v1/crawl', {
    method:'POST',
    headers:{ Authorization:`Bearer ${process.env.FIRECRAWL_KEY}`, 'Content-Type':'application/json' },
    body: JSON.stringify({ url })
  });
  const job = await resp.json();
  // Poll job / 或 webhook 回调
  const md = await fetch(job.result_url).then(r=>r.text());

  // 解析 md -> 提取 title, characters, images
  const parsed = parseMarkdownForWork(md);

  // 存 snapshot
  const { data: snapshot } = await supabase.from('source_snapshots').insert({
    url, fetched_at: new Date().toISOString(), raw_md: md
  }).select().single();

  // 入库作品
  const { data: work } = await supabase.from('works').insert({
    title: parsed.title, summary_md: parsed.summary, primary_source: url, source_snapshot_id: snapshot.id, created_by: createdBy
  }).select().single();

  // 入库角色
  for (const ch of parsed.characters) {
    // 下载图片到 Supabase Storage（略）
    await supabase.from('characters').insert({
      work_id: work.id, name: ch.name, summary_md: ch.summary, image_url: ch.img_storage_path, sources: [{url, title: parsed.title}]
    });
  }
}

14 可能的难点与解决策略（风险管理）

同名/歧义条目：采用 LLM + 人工审核混合流程；界面给管理员“合并/拆分条目”工具。
deepseek.com
+1

版权/转载限制：严格保留来源元数据；若来源声明“不可商用”则只能以极短摘要 + 链接呈现，不直接复制全文。
萌娘百科

刷票/恶意行为：强制登录、速率限制、投票历史审计、必要时加入验证码与风控。

成本管理（火力与模型）：抓取/LLM 调用做队列与限速、缓存摘要、仅在必要时调用 LLM（例如：人工点击“自动匹配”时）。

15 附：参考与关键链接（便于立刻查阅）

Personality-Database（产品参考）。
personality-database.com

Firecrawl 文档（中文）：快速上手 / API 参考。
docs.firecrawl.dev
+1

Supabase 官方文档（Auth/Storage/Realtime）：快速上手。
Supabase
+1

DeepSeek 官网（模型与 API 概览，可用于 agent/推理场景）。
deepseek.com

通义千问（Qwen）API 文档（阿里云帮助中心）。
阿里云帮助中心

EVA Colors / Eva Design System（配色与设计资源）。
colors.eva.design
+1

萌娘百科（抓取目标站点之一，注意版权声明）。
萌娘百科