# 管理员功能指南

## 🔐 权限说明

只有 `role` 为 `admin` 或 `mod` 的用户可以访问管理员功能。

### 如何设置管理员

在 Supabase SQL Editor 中执行：

```sql
-- 将用户设置为管理员
UPDATE users 
SET role = 'admin' 
WHERE email = 'your-email@example.com';

-- 或者将用户设置为版主
UPDATE users 
SET role = 'mod' 
WHERE email = 'moderator@example.com';
```

---

## 📋 管理员页面地址

### 1. **管理员首页**
- **URL**: `/admin`
- **功能**: 管理员控制台首页，显示统计数据和快捷操作

### 2. **管理作品列表**
- **URL**: `/admin/works`
- **功能**: 
  - 查看所有作品列表
  - 搜索作品
  - 删除作品
  - 跳转到编辑页面

### 3. **编辑作品**
- **URL**: `/admin/works/{作品ID}/edit`
- **示例**: `/admin/works/123e4567-e89b-12d3-a456-426614174000/edit`
- **功能**:
  - 修改作品中文名、英文名、日文名
  - 修改别名
  - 修改作品类型（支持多选）
  - 修改海报图片链接
  - 修改简介

### 4. **管理角色列表**
- **URL**: `/admin/characters`
- **功能**:
  - 查看所有角色列表
  - 搜索角色（支持角色名和作品名）
  - 删除角色
  - 跳转到编辑页面

### 5. **编辑角色**
- **URL**: `/admin/characters/{角色ID}/edit`
- **示例**: `/admin/characters/456e7890-e89b-12d3-a456-426614174000/edit`
- **功能**:
  - 修改角色中文名、英文名、日文名
  - 修改角色图片链接

---

## 🖼️ 图片链接推荐

### ✅ 推荐的图床服务

1. **Imgur** (最推荐)
   - 网址: https://imgur.com/
   - 特点: 无防盗链，稳定，免费
   - 示例: `https://i.imgur.com/abc123.jpg`

2. **Wikimedia Commons**
   - 网址: https://commons.wikimedia.org/
   - 特点: 开放授权，无防盗链
   - 示例: `https://upload.wikimedia.org/wikipedia/commons/...`

3. **GitHub**
   - 上传到 GitHub Issues 作为图床
   - 特点: 永久有效，无防盗链
   - 示例: `https://user-images.githubusercontent.com/...`

### ❌ 不推荐的图床

以下图床**有防盗链保护**，无法在外部网站显示：

- ❌ 百度图片 (`pics3.baidu.com`, `img2.baidu.com` 等)
- ❌ 花瓣网 (`hbimg.huaban.com`)
- ❌ 微博图床 (`sinaimg.cn`)
- ❌ QQ空间图床

---

## 👥 用户功能

### 提交角色

普通用户（无需管理员权限）可以为作品添加角色：

1. 访问任意作品详情页 `/works/{作品ID}`
2. 点击 **"Add Character"** 按钮
3. 填写角色信息
4. 提交

**路径**: `/works/{作品ID}/submit-character`

---

## 🛠️ 管理员常用操作

### 编辑作品

1. 访问 `/admin/works`
2. 找到要编辑的作品
3. 点击 **编辑图标** (✏️)
4. 修改信息
5. 点击 **保存修改**

### 删除作品

1. 访问 `/admin/works`
2. 找到要删除的作品
3. 点击 **删除图标** (🗑️)
4. 确认删除

**注意**: 删除作品会同时删除该作品的所有角色和投票数据（数据库级联删除）。

### 编辑角色

1. 访问 `/admin/characters`
2. 找到要编辑的角色
3. 点击 **编辑图标** (✏️)
4. 修改信息
5. 点击 **保存修改**

### 删除角色

1. 访问 `/admin/characters`
2. 找到要删除的角色
3. 点击 **删除图标** (🗑️)
4. 确认删除

**注意**: 删除角色会同时删除该角色的所有投票和评论数据（数据库级联删除）。

---

## 🔍 搜索功能

在 `/admin/works` 页面，可以使用搜索框快速查找作品：
- 支持搜索中文名
- 支持搜索英文名
- 支持搜索日文名

---

## 🌐 前端本地测试

1. 确保数据库已连接
2. 设置自己为管理员（见上方 SQL）
3. 登录账号
4. 访问 `http://localhost:5173/admin/works`

---

## 📝 注意事项

1. **权限检查**: 每个管理员页面都会检查用户权限，非管理员会被拒绝访问
2. **数据安全**: 删除操作需要二次确认
3. **图片链接**: 使用推荐的图床服务，避免防盗链问题
4. **用户提交**: 普通用户可以为作品添加角色，管理员可以编辑或删除
5. **级联删除**: 删除作品或角色会同时删除相关的投票、评论等数据

